<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>抖音热榜</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #0f0f14;
      color: #e5e5e5;
      min-height: 100vh;
    }

    .container {
      width: 100%;
      max-width: 900px;
      margin: 0 auto;
      padding: 16px 24px;
    }

    .header {
      text-align: center;
      padding: 20px 0 16px;
    }

    .header h1 {
      font-size: 1.4rem;
      font-weight: 700;
    }

    .timer {
      font-size: 0.75rem;
      color: #666;
      margin-top: 6px;
    }

    .tabs {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      padding: 10px 0;
      position: sticky;
      top: 0;
      z-index: 10;
      background: #0f0f14;
    }

    .tab {
      padding: 6px 12px;
      border: 1px solid #333;
      border-radius: 4px;
      background: transparent;
      color: #888;
      font-size: 0.8rem;
      cursor: pointer;
      white-space: nowrap;
    }

    .tab:hover {
      border-color: #fe2c55;
      color: #ccc;
    }

    .tab.active {
      background: #fe2c55;
      border-color: #fe2c55;
      color: #fff;
    }

    .section {
      margin-bottom: 20px;
    }

    .section-title {
      font-size: 0.8rem;
      color: #888;
      margin-bottom: 10px;
      padding-left: 2px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .section-title::before {
      content: '';
      width: 3px;
      height: 12px;
      background: #fe2c55;
      border-radius: 1px;
    }

    .list {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 8px;
    }

    .item {
      display: flex;
      gap: 12px;
      padding: 12px;
      background: #1a1a22;
      border-radius: 6px;
      cursor: pointer;
      transition: background 0.15s;
    }

    .item:hover {
      background: #222230;
    }

    .rank {
      width: 24px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.85rem;
      font-weight: 600;
      color: #666;
      flex-shrink: 0;
    }

    .rank.r1,
    .rank.r2,
    .rank.r3 {
      color: #fe2c55;
    }

    .content {
      flex: 1;
      min-width: 0;
    }

    .title {
      font-size: 0.9rem;
      line-height: 1.4;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .meta {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-top: 4px;
      font-size: 0.7rem;
      color: #666;
    }

    .bar-bg {
      flex: 1;
      height: 2px;
      background: #2a2a35;
      border-radius: 1px;
    }

    .bar {
      height: 100%;
      background: #fe2c55;
      border-radius: 1px;
      transition: width 0.3s;
    }

    .tag {
      padding: 1px 4px;
      border-radius: 2px;
      font-size: 0.65rem;
    }

    .tag-hot {
      background: rgba(254, 44, 85, 0.2);
      color: #fe2c55;
    }

    .tag-new {
      background: rgba(34, 197, 94, 0.2);
      color: #22c55e;
    }

    .tag-rising {
      background: rgba(251, 191, 36, 0.2);
      color: #fbbf24;
    }

    .loading {
      text-align: center;
      padding: 40px;
      color: #666;
      font-size: 0.85rem;
    }

    .error {
      text-align: center;
      padding: 40px;
    }

    .error p {
      color: #888;
      margin-bottom: 12px;
      font-size: 0.85rem;
    }

    .error button {
      padding: 8px 16px;
      background: #fe2c55;
      border: none;
      border-radius: 4px;
      color: #fff;
      cursor: pointer;
    }

    .footer {
      text-align: center;
      padding: 24px;
      color: #444;
      font-size: 0.7rem;
    }

    @media (max-width: 640px) {
      .container {
        padding: 16px;
      }

      .list {
        grid-template-columns: 1fr;
      }

      .tabs {
        flex-wrap: nowrap;
        overflow-x: auto;
      }
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="header">
      <h1>抖音热榜</h1>
      <div class="timer" id="timer">45秒后刷新</div>
    </div>
    <div class="tabs" id="tabs"></div>
    <div id="content"></div>
    <div class="footer">数据来源：抖音热搜榜</div>
  </div>

  <script>
    const PROXY = 'https://api.codetabs.com/v1/proxy/?quest=';
    const API = 'https://so-landing.douyin.com/aweme/v1/hot/search/list/';

    const LABELS = {
      1: ['新', 'tag-new'],
      3: ['爆', 'tag-hot'],
      5: ['首', 'tag-hot'],
      8: ['荐', 'tag-hot']
    };

    const $tabs = document.getElementById('tabs');
    const $content = document.getElementById('content');
    const $timer = document.getElementById('timer');

    let tabs = [], items = [], trending = [], countdown = 45, currentType = 0, currentSub = '';

    function buildUrl(type, sub) {
      return PROXY + encodeURIComponent(`${API}?board_type=${type}&board_sub_type=${sub}&need_board_tab=true&version_code=32.5.0`);
    }

    function formatNum(n) {
      if (!n) return '0';
      return n >= 1e8 ? (n / 1e8).toFixed(1) + '亿' : n >= 1e4 ? (n / 1e4).toFixed(1) + '万' : String(n);
    }

    function renderTabs() {
      if (!tabs.length) return;
      $tabs.innerHTML = tabs.map((t, i) =>
        `<button class="tab ${i === 0 ? 'active' : ''}" data-type="${t.board_type ?? 0}" data-sub="${t.board_sub_type ?? ''}">${t.tab_name || '热搜'}</button>`
      ).join('');
    }

    function renderItems(list, showRank = true) {
      const maxHot = Math.max(...list.map(it => it.hot_value || 0), 1);
      return list.map((it, i) => {
        const r = i + 1;
        const h = it.hot_value || 0;
        const pct = h > 0 ? Math.max(5, h / maxHot * 100) : 0;
        const lbl = LABELS[it.label];
        const tag = lbl ? `<span class="tag ${lbl[1]}">${lbl[0]}</span>` : '';
        const rankHtml = showRank ? `<div class="rank ${r <= 3 ? 'r' + r : ''}">${r}</div>` : '';

        const metaHtml = h > 0
          ? `<span>${formatNum(h)}</span><div class="bar-bg"><div class="bar" style="width:${pct}%"></div></div>${tag}`
          : `<span class="tag tag-rising">上升中</span>`;

        return `<div class="item" data-word="${it.word || ''}">
          ${rankHtml}
          <div class="content">
            <div class="title">${it.word || ''}</div>
            <div class="meta">${metaHtml}</div>
          </div>
        </div>`;
      }).join('');
    }

    function renderPage() {
      let html = '';

      if (trending.length) {
        html += `
          <div class="section">
            <div class="section-title">实时上升热点</div>
            <div class="list">${renderItems(trending, false)}</div>
          </div>`;
      }

      if (items.length) {
        html += `
          <div class="section">
            <div class="section-title">热搜榜</div>
            <div class="list">${renderItems(items, true)}</div>
          </div>`;
      }

      if (!html) html = '<div class="loading">暂无数据</div>';
      $content.innerHTML = html;
    }

    async function fetchHot(type = 0, sub = '') {
      $content.innerHTML = '<div class="loading">加载中...</div>';
      try {
        const res = await fetch(buildUrl(type, sub));
        const json = await res.json();

        if (json.board_tabs?.length && !tabs.length) {
          tabs = json.board_tabs;
          renderTabs();
        }

        trending = json.data?.trending_list || [];
        items = json.data?.word_list || json.data_list || [];
        renderPage();
      } catch (e) {
        $content.innerHTML = `<div class="error"><p>加载失败</p><button onclick="fetchHot(${type},'${sub}')">重试</button></div>`;
      }
    }

    $tabs.onclick = e => {
      const t = e.target.closest('.tab');
      if (!t || t.classList.contains('active')) return;
      $tabs.querySelectorAll('.tab').forEach(x => x.classList.remove('active'));
      t.classList.add('active');
      currentType = t.dataset.type;
      currentSub = t.dataset.sub;
      countdown = 45;
      fetchHot(currentType, currentSub);
    };

    $content.onclick = e => {
      const item = e.target.closest('.item');
      if (item) window.open('https://www.douyin.com/search/' + encodeURIComponent(item.dataset.word), '_blank');
    };

    setInterval(() => {
      countdown--;
      if (countdown <= 0) { countdown = 45; fetchHot(currentType, currentSub); }
      $timer.textContent = `${countdown}秒后刷新`;
    }, 1000);

    fetchHot();
  </script>
</body>

</html>